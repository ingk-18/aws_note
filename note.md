# ネットワーク

# VPC

- 「リージョン = 国や地域の単位」
  - 「AZ = その中のデータセンター単位」

## NAT
- NAT（Network Address Translation）は、ネットワークアドレス変換の略で、プライベートネットワーク内のIPアドレスを、外部のパブリックネットワーク（通常はインターネット）に接続する際に変換する技術です。NATインスタンスやNATゲートウェイを使用して、プライベートサブネット内のリソースがインターネットにアクセスできるようにしつつ、外部からの直接アクセスを防ぐことができます。


| 種類         | 説明                                                                 |
|--------------|----------------------------------------------------------------------|
| NATインスタンス | EC2インスタンスをNAT用に設定して、プライベートサブネットからインターネット通信を中継する方法。 |
| NATゲートウェイ | AWSが提供するフルマネージド型のNATサービス。                           |




### インターネットを経由せずにAWSサービスにアクセスするための手段

| 特徴               | VPCエンドポイント                          | AWS PrivateLink                        | VPCピアリング                          |
|--------------------|-------------------------------------------|----------------------------------------|----------------------------------------|
| 対象サービス       | 主にS3やDynamoDBなどの特定のAWSサービス   | AWSサービスおよびサードパーティサービス | VPC間の通信                           |
| 接続方法           | ゲートウェイエンドポイントまたはインターフェイスエンドポイント | インターフェイスエンドポイント         | VPC間の直接接続                       |
| 主な用途           | 特定のAWSサービスへのプライベートアクセス | 幅広いサービスへのプライベートアクセス | VPC間のプライベート通信               |
| セキュリティ       | インターネットを経由せずにアクセス可能     | インターネットを経由せずにアクセス可能 | インターネットを経由せずにアクセス可能 |
| サードパーティ対応 | 対応していない                             | 対応している                           | 対応していない                         |


- VPCピアリング
  - VPC同士を1対1で接続する機能です。同一アカウントのVPC同士や他のAWSアカウントのVPC、異なるリージョンのVPCでも、同一のプライベートネットワーク内に存在しているかのように相互に通信できます。

## ルートテーブル

ルートテーブルは、VPC内のサブネットから送信(受信ではない)されるトラフィックの経路を決定するためのものです。各エントリは、特定のIPアドレス範囲に対して、どのターゲット（例: インターネットゲートウェイ、NATゲートウェイ）を使用するかを指定します。

## セキュリティグループとネットワークACLの違い

![](images/2025-02-08-17-49-34.png)



| 特徴 | セキュリティグループ | ネットワークACL |
|------|---------------------|-----------------|
| レベル | インスタンスレベル | サブネットレベル |
| ステート | ステートフル（外部からのリクエストが許可されると、その応答も自動的に許可） | ステートレス（外部からのリクエストとその応答を個別に設定） |
| デフォルト設定 | 外部からのすべてのリクエストを拒否し、内部からの応答を許可 | 外部からのすべてのリクエストと応答を許可 |
| ルールの種類 | 許可のみ設定可能 | 許可と拒否の両方を設定可能 |
| 適用範囲 | 各インスタンスに個別に設定 | サブネット全体に適用 |



# ELB

## ALBのルーティングの種類と具体例

| ルーティングの種類 | 説明 | 具体例 |
|------------------|------|--------|
| **パスベースルーティング** | リクエストのURLパスに基づいてルーティングを行う。 | `/images/*`のパスを持つリクエストを画像サーバーにルーティング。例: `/images/photo.jpg` |
| **ホストベースルーティング** | リクエストのホストヘッダー（ドメイン名）に基づいてルーティングを行う。 | `example.com`へのリクエストをウェブサーバーに、`api.example.com`へのリクエストをAPIサーバーにルーティング。 |
| **HTTPヘッダールーティング** | 特定のHTTPヘッダーの値に基づいてルーティングを行う。 | `X-Environment: production`のヘッダーを持つリクエストを本番環境にルーティング。 |
| **クエリパラメータルーティング** | リクエストのクエリパラメータに基づいてルーティングを行う。 | `?version=beta`のクエリを持つリクエストをベータ版サーバーにルーティング。例: `https://example.com/app?version=beta` |
| **メソッドベースルーティング** | HTTPメソッド（GET, POST, PUTなど）に基づいてルーティングを行う。 | `POST`メソッドのリクエストをデータ処理サーバーにルーティング。 |



# S3

## S3のアクセス制御の種類まとめ

| 方法 | 制御単位 | 特徴 | 主な用途 | AWSアカウントへの制限 |
|------|----------|------|---------|----------------------|
| **S3バケットポリシー** | **バケット単位** | IPアドレスやドメイン単位でのアクセス制御、自AWSアカウントの制御 | **バケットごとのアクセス管理** | 可能 |
| **IAMポリシー** | **IAMユーザー・ロール** | AWSリソース全体で適用可能 | **AWSアカウント内のアクセス制御** | 間接的に可能 |
| **S3 ACL** | **オブジェクト単位** | 他AWSアカウント単位でアクセス権限を設定する読み取りまたは書き込みを許可できる機能です。アクセス元のIPアドレスやドメイン単位でのアクセス制御はできない | **特定のオブジェクトに特別な権限を設定** | 可能 |
| **Presigned URL** | **オブジェクト単位** | 一時的なアクセス許可 | **期限付きのダウンロード・アップロード** | 制限不可（生成者の権限に依存） |


## S3のストレージクラスまとめ

| ストレージクラス | 特徴 | 主な用途 |
|------------------|------|---------|
| **S3 Standard** | 高い耐久性と可用性 | 頻繁にアクセスされるデータ |
| **S3 Intelligent-Tiering** | アクセスパターンに基づいて自動的に階層を移動 | アクセスパターンが不明なデータ |
| **S3 Standard-IA** | 低頻度アクセス用、低コスト | 頻繁にはアクセスされないが、即時アクセスが必要なデータ |
| **S3 One Zone-IA** | 低頻度アクセス用、単一AZで低コスト | 再作成可能なデータ |
| **S3 Glacier Instant Retrieval** | アーカイブ用、即時アクセス可能、低コスト | 即時アクセスが必要なアーカイブデータ |
| **S3 Glacier Flexible Retrieval** | アーカイブ用、柔軟な取得オプション、低コスト | アーカイブデータで、数分から数時間の取得が可能 |
| **S3 Glacier Deep Archive** | 最も低コストのアーカイブ | 長期保存が必要なデータ |

